# 第1节：编译合约

## 前置条件

已经安装golang



## 安装编译器

```sh
# Ubuntu
sudo snap install solc --edge

# MacOS
brew update
brew tap ethereum/ethereum
brew install solidity
```



## 安装aibgen

```sh
go get -u github.com/ethereum/go-ethereum
cd $GOPATH/src/github.com/ethereum/go-ethereum/
make
make devtools
```



## 编写合约

创建工程：go mod init code，并创建文件contracts/Store.sol

```js
// SPDX-License-Identifier: GPL-3.0
pragma solidity =0.8.15;

contract Store {
  event ItemSet(bytes32 key, bytes32 value);

  string public version;
  mapping (bytes32 => bytes32) public items;

  constructor(string memory _version) {
    version = _version;
  }

  function setItem(bytes32 key, bytes32 value) external {
    items[key] = value;
    emit ItemSet(key, value);
  }
}
```



## 编译

```sh
# 1.通过.sol编译出abi
solc --abi contracts/Store.sol -o abi

# 2.通过abi编译出go文件
abigen --abi=abi/Store.abi --pkg=store --out=src/Store.go

# 3.编译bytecode
solc --bin contracts/Store.sol

# 4.安装go依赖包
go mod tidy
```



## 当前工程

![image-20221129180249204](https://duke-typora.s3.ap-southeast-1.amazonaws.com/uPic/image-20221129180249204.png)



## 链接

- makefile：https://makefiletutorial.com/#getting-started
- go开发以太坊：
  - EN：https://goethereumbook.org/en/
  - CN：https://goethereumbook.org/zh/

