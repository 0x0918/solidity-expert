## 共识层攻击

POW&POS



## 密码学攻击

### 弱随机性导致私钥泄漏

最著名的就是Profanity私钥被暴力破解事件，其原因是随机数范围太小了，使用2^32位来生成2^256的随机数，导致被暴力破解，[点击查看案例分析](https://mp.weixin.qq.com/s/hVvxlVwoSfI8kaxbxIdBlA)



### hash碰撞

通过构造特定的合约calldata（主要是四字节的sig），可以实现攻击，这个四字节sig可以通过hash碰撞来实现，August 10, 2021 ploy网络的攻击就是这个原理，

慢雾分析：[点击查看](https://slowmist.medium.com/the-root-cause-of-poly-network-being-hacked-ec2ee1b0c68f)

BlockSec分析：[点击查看](https://blocksecteam.medium.com/the-initial-analysis-of-the-polynetwork-hack-270ac6072e2a)

```sh
byte4(keccak256(transfer(address,uint256))) = 0xa9059cbb
```

**合约关系：**

![image-20221211173609673](https://duke-typora.s3.ap-southeast-1.amazonaws.com/uPic/image-20221211173609673.png)



### 重放攻击

当前的区块链系统中，用户对交易的签名有两种形式：

1. 包含6个字段信息（RLP编码元素）：`nonce, gasprice, startgas, to, value, data`。
2. 包含9个字段信息（RLP编码元素）`nonce, gasprice, startgas, to, value, data, chainid, 0, 0`，多了后面三个字段。（主要区别是chainid）



对于第一种交易，签名v值为：`{0,1} + 27`，第二种交易形式（符合EIP1155标准）：签名v值为：`{0,1} + chainid * 2 + 35`

根据ECDSA签名原理我们知道（r，s，v）：在v值不相同的时候，即使r和s相同，还原出来的公钥也是不相同的。所以满足EIP1155标准的交易可以阻止重放攻击。



当前的区块链世界是一个多链并存的世界，并且很多链都是EVM兼容的，对于不带chainid的签名交易，我们可以把这条链上的交易信息读取出来，然后在另外一条链上执行，这样就会导致交易被再次执行（因为签名都是有效的），这就是所谓的重放攻击，所以使用chainid可以保证无法被重放，因为每条链的chainid不同。



**重放方法：**

1. 在A链上直接获取data数据
2. 在B链上调用方法：eth_sendRawTransaction直接发送交易即可，[点击查看手册](https://ethereum.org/en/developers/docs/apis/json-rpc/#eth_sendrawtransaction)



**案例分析**：

OP代币被重放攻击案例分析：[点击查看](https://www.freebuf.com/articles/blockchain-articles/335903.html)

安全牛分析：[点击查看](https://www.aqniu.com/industry/84486.html)，[攻击交易](https://optimistic.etherscan.io/address/0x2501c477d0a35545a387aa4a3eee4292a9a8b3f0)



## 出块攻击



## EVM攻击

